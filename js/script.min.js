const menu=document.querySelector(".main-nav"),btnMenu=document.querySelector(".main-nav__toggle"),toggleMenu=function(){menu.classList.toggle("main-nav--opened"),menu.classList.toggle("main-nav--closed")};menu.classList.remove("main-nav--nojs"),btnMenu.addEventListener("click",(function(t){t.stopPropagation(),toggleMenu()})),document.addEventListener("click",(function(t){const e=t.target,n=e==menu||menu.contains(e),o=e==btnMenu,c=menu.classList.contains("main-nav--opened");n||o||!c||toggleMenu()})),window.onload=function(){window.addEventListener("scroll",(function(t){window.scrollY>=115?menu.classList.add("main-nav--is-fixed"):menu.classList.remove("main-nav--is-fixed")}))};const search=document.querySelector(".search"),btnSearch=document.querySelector(".search__toggle"),toggleSearch=function(){search.classList.toggle("search--opened"),search.classList.toggle("search--closed")};btnSearch.addEventListener("click",(function(t){t.stopPropagation(),toggleSearch()})),document.addEventListener("click",(function(t){const e=t.target,n=e==search||search.contains(e),o=e==btnSearch,c=search.classList.contains("search--opened");n||o||!c||toggleSearch()}));let navMainList=document.querySelector(".main-nav .category-list"),navMainUserList=document.querySelector(".main-nav .user-list"),catMainList=document.querySelector(".categories .category-list");window.matchMedia("(max-width: 767px)").matches?catMainList&&catMainList.remove():window.matchMedia("(min-width: 768px) and (max-width: 1199px)").matches?(navMainList&&navMainList.remove(),navMainUserList&&navMainUserList.remove(),catMainList&&catMainList.remove()):window.matchMedia("(min-width: 1200px)").matches&&(navMainList&&navMainList.remove(),navMainUserList&&navMainUserList.remove());let $tabs=function(t){let e,n="string"==typeof t?document.querySelector(t):t,o=function(t){let n,o,c;n=document.querySelector(t.getAttribute("href")),o=t.parentElement.parentElement.querySelector(".single-product-tab__nav-item--active"),c=n.parentElement.querySelector(".single-product-tab__pane--active"),t!==o&&(null!==o&&o.classList.remove("single-product-tab__nav-item--active"),null!==c&&c.classList.remove("single-product-tab__pane--active"),t.parentElement.classList.add("single-product-tab__nav-item--active"),n.classList.add("single-product-tab__pane--active"),document.dispatchEvent(e))};return e=new CustomEvent("tab.show",{detail:n}),n.addEventListener("click",(function(t){let e=t.target;e.parentElement.classList.contains("single-product-tab__nav-item")&&!e.parentElement.classList.contains("single-product-tab__nav-item--notab")&&(t.preventDefault(),o(e))})),{showTab:function(t){o(t)},switchTabTo:function(t){!function(t){let e=n.querySelectorAll(".single-product-tab__nav-item");e.length>0&&(t>e.length?t=e.length:t<1&&(t=1),o(e[t-1]))}(t)}}},listTabs=document.querySelectorAll(".single-product-tabs");for(let t=0,e=listTabs.length;t<e;t++)$tabs(listTabs[t]);document.querySelectorAll('a[href^="#"].anchor-link').forEach(t=>{t.addEventListener("click",(function(t){t.preventDefault();let e=this.getAttribute("href").substring(1);const n=document.getElementById(e),o=document.querySelector(".single-product-tab__nav-list").offsetHeight,c=n.getBoundingClientRect().top-o-60;window.scrollBy({top:c,behavior:"smooth"})}))});let cityLink=document.querySelectorAll(".city-choosing__city");if(0!==cityLink.length){let t=document.getElementById("modal__geo"),e=t.getElementsByClassName("modal__button--close");popupAction(cityLink,t,e)}let gridAddCartLink=document.querySelectorAll(".article-product-g__cart");if(0!==gridAddCartLink.length){let t=document.getElementById("modal__add-cart"),e=t.getElementsByClassName("modal__button--close");popupAction(gridAddCartLink,t,e)}let listAddCartLink=document.querySelectorAll(".article-product-l__cart");if(0!==listAddCartLink.length){let t=document.getElementById("modal__add-cart"),e=t.getElementsByClassName("modal__button--close");popupAction(listAddCartLink,t,e)}let productAddCartLink=document.querySelectorAll(".single-product__button-buy");if(0!==productAddCartLink.length){let t=document.getElementById("modal__add-cart"),e=t.getElementsByClassName("modal__button--close");popupAction(productAddCartLink,t,e)}let productCallbackLink=document.querySelectorAll(".single-product__callback");if(0!==productCallbackLink.length){let t=document.getElementById("modal__callback"),e=t.getElementsByClassName("modal__button--close");popupAction(productCallbackLink,t,e)}let sProductBuyocLink=document.querySelectorAll(".single-product__button-buyoc");if(0!==sProductBuyocLink.length){let t=document.getElementById("modal__buyoc"),e=t.getElementsByClassName("modal__button--close");popupAction(sProductBuyocLink,t,e)}let gridBuyocLink=document.querySelectorAll(".article-product-g__buyoneclick");if(0!==gridBuyocLink.length){let t=document.getElementById("modal__buyoc"),e=t.getElementsByClassName("modal__button--close");popupAction(gridBuyocLink,t,e)}let listBuyocLink=document.querySelectorAll(".article-product-l__buyoneclick");if(0!==listBuyocLink.length){let t=document.getElementById("modal__buyoc"),e=t.getElementsByClassName("modal__button--close");popupAction(listBuyocLink,t,e)}function popupAction(t,e,n){let o=function(){e.classList.toggle("modal__show")};for(var c=0;c<t.length;c++)t[c].addEventListener("click",(function(t){t.stopPropagation(),o()}));for(c=0;c<n.length;c++)n[c].addEventListener("click",(function(t){e.classList.contains("modal__show")&&(t.preventDefault(),e.classList.remove("modal__show"),e.classList.remove("modal__error"))}));window.addEventListener("keydown",(function(t){27===t.keyCode&&e.classList.contains("modal__show")&&(t.preventDefault(),e.classList.remove("modal__show"),e.classList.remove("modal__error"))})),document.addEventListener("click",(function(n){const c=n.target,l=c==e||e.contains(c),i=c==t,a=e.classList.contains("modal__show");l||i||!a||o()}))}let productsGrid=document.querySelector(".products-grid"),productsList=document.querySelector(".products-list");if(productsGrid&&productsList){function toggleGl(t,e){t.addEventListener("click",(function(n){productsGrid.style.display="flex",e.classList.remove("sorting-filter__gl-btn--active"),t.classList.add("sorting-filter__gl-btn--active"),productsList.style.display="none"})),e.addEventListener("click",(function(n){productsGrid.style.display="none",t.classList.remove("sorting-filter__gl-btn--active"),e.classList.add("sorting-filter__gl-btn--active"),productsList.style.display="flex"}))}toggleGl(document.querySelector(".sorting-filter__g-btn"),document.querySelector(".sorting-filter__l-btn"))}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5taW4uanMiXSwibmFtZXMiOlsibWVudSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJ0bk1lbnUiLCJ0b2dnbGVNZW51IiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwicmVtb3ZlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJ0YXJnZXQiLCJpdHNfbWVudSIsImNvbnRhaW5zIiwiaXRzX2J0bk1lbnUiLCJtZW51X2lzX2FjdGl2ZSIsIndpbmRvdyIsIm9ubG9hZCIsInNjcm9sbFkiLCJhZGQiLCJzZWFyY2giLCJidG5TZWFyY2giLCJ0b2dnbGVTZWFyY2giLCJpdHNfc2VhcmNoIiwiaXRzX2J0blNlYXJjaCIsInNlYXJjaF9pc19hY3RpdmUiLCJuYXZNYWluTGlzdCIsIm5hdk1haW5Vc2VyTGlzdCIsImNhdE1haW5MaXN0IiwibWF0Y2hNZWRpYSIsIm1hdGNoZXMiLCIkdGFicyIsIl9ldmVudFRhYnNTaG93IiwiX2VsZW1UYWJzIiwiX3Nob3dUYWIiLCJ0YWJzTGlua1RhcmdldCIsInRhYnNQYW5lVGFyZ2V0IiwidGFic0xpbmtBY3RpdmUiLCJ0YWJzUGFuZVNob3ciLCJnZXRBdHRyaWJ1dGUiLCJwYXJlbnRFbGVtZW50IiwiZGlzcGF0Y2hFdmVudCIsIkN1c3RvbUV2ZW50IiwiZGV0YWlsIiwicHJldmVudERlZmF1bHQiLCJzaG93VGFiIiwic3dpdGNoVGFiVG8iLCJpbmRleCIsInRhYnNMaW5rSW5kZXgiLCJ0YWJzTGlua3MiLCJxdWVyeVNlbGVjdG9yQWxsIiwibGVuZ3RoIiwiX3N3aXRjaFRhYlRvIiwibGlzdFRhYnMiLCJpIiwiZm9yRWFjaCIsImxpbmsiLCJocmVmIiwidGhpcyIsInN1YnN0cmluZyIsInNjcm9sbFRhcmdldCIsImdldEVsZW1lbnRCeUlkIiwidG9wT2Zmc2V0Iiwib2Zmc2V0SGVpZ2h0Iiwib2Zmc2V0UG9zaXRpb24iLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ0b3AiLCJzY3JvbGxCeSIsImJlaGF2aW9yIiwiY2l0eUxpbmsiLCJwb3B1cCIsInBvcHVwQ2xvc2UiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwicG9wdXBBY3Rpb24iLCJncmlkQWRkQ2FydExpbmsiLCJsaXN0QWRkQ2FydExpbmsiLCJwcm9kdWN0QWRkQ2FydExpbmsiLCJwcm9kdWN0Q2FsbGJhY2tMaW5rIiwic1Byb2R1Y3RCdXlvY0xpbmsiLCJncmlkQnV5b2NMaW5rIiwibGlzdEJ1eW9jTGluayIsInBvcHVwTGluayIsInRvZ2dsZUNpdHkiLCJldnQiLCJrZXlDb2RlIiwiaXRzX3BvcHVwIiwiaXRzX3BvcHVwTGluayIsInBvcHVwX2lzX2FjdGl2ZSIsInByb2R1Y3RzR3JpZCIsInByb2R1Y3RzTGlzdCIsInRvZ2dsZUdsIiwiZ3JpZCIsImxpc3QiLCJzdHlsZSIsImRpc3BsYXkiXSwibWFwcGluZ3MiOiJBQUNBLE1BQU1BLEtBQU9DLFNBQVNDLGNBQWMsYUFDOUJDLFFBQVVGLFNBQVNDLGNBQWMscUJBQ2pDRSxXQUFhLFdBQ2pCSixLQUFLSyxVQUFVQyxPQUFPLG9CQUN0Qk4sS0FBS0ssVUFBVUMsT0FBTyxxQkFHeEJOLEtBQUtLLFVBQVVFLE9BQU8sa0JBRXRCSixRQUFRSyxpQkFBaUIsU0FBUyxTQUFTQyxHQUN6Q0EsRUFBRUMsa0JBQ0ZOLGdCQUdGSCxTQUFTTyxpQkFBaUIsU0FBUyxTQUFTQyxHQUMxQyxNQUFNRSxFQUFTRixFQUFFRSxPQUNYQyxFQUFXRCxHQUFVWCxNQUFRQSxLQUFLYSxTQUFTRixHQUMzQ0csRUFBY0gsR0FBVVIsUUFDeEJZLEVBQWlCZixLQUFLSyxVQUFVUSxTQUFTLG9CQUUxQ0QsR0FBYUUsSUFBZUMsR0FDN0JYLGdCQUtOWSxPQUFPQyxPQUFTLFdBUWRELE9BQU9SLGlCQUFpQixVQVB4QixTQUFrQkMsR0FDYk8sT0FBT0UsU0FBVyxJQUNuQmxCLEtBQUtLLFVBQVVjLElBQUksc0JBRW5CbkIsS0FBS0ssVUFBVUUsT0FBTywwQkFRNUIsTUFBTWEsT0FBU25CLFNBQVNDLGNBQWMs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R0FDMUMsTUFBTXhFLEVBQVN3RSxFQUFJeEUsT0FDYjBFLEVBQVkxRSxHQUFVMkQsR0FBU0EsRUFBTXpELFNBQVNGLEdBQzlDMkUsRUFBZ0IzRSxHQUFVc0UsRUFDMUJNLEVBQWtCakIsRUFBTWpFLFVBQVVRLFNBQVMsZUFFNUN3RSxHQUFjQyxJQUFpQkMsR0FDbENMLE9BTU4sSUFBSU0sYUFBZXZGLFNBQVNDLGNBQWMsa0JBQ3RDdUYsYUFBZXhGLFNBQVNDLGNBQWMsa0JBRTFDLEdBQUlzRixjQUFnQkMsYUFBYyxDQU1oQyxTQUFTQyxTQUFTQyxFQUFNQyxHQUN0QkQsRUFBS25GLGlCQUFpQixTQUFTLFNBQVMyRSxHQUN0Q0ssYUFBYUssTUFBTUMsUUFBVSxPQUM3QkYsRUFBS3ZGLFVBQVVFLE9BQU8sa0NBQ3RCb0YsRUFBS3RGLFVBQVVjLElBQUksa0NBQ25Cc0UsYUFBYUksTUFBTUMsUUFBVSxVQUcvQkYsRUFBS3BGLGlCQUFpQixTQUFTLFNBQVMyRSxHQUN0Q0ssYUFBYUssTUFBTUMsUUFBVSxPQUM3QkgsRUFBS3RGLFVBQVVFLE9BQU8sa0NBQ3RCcUYsRUFBS3ZGLFVBQVVjLElBQUksa0NBQ25Cc0UsYUFBYUksTUFBTUMsUUFBVSxVQWRqQ0osU0FIV3pGLFNBQVNDLGNBQWMsMEJBQ3ZCRCxTQUFTQyxjQUFjIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBNZW51IC8vXG5jb25zdCBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tYWluLW5hdlwiKTtcbmNvbnN0IGJ0bk1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1haW4tbmF2X190b2dnbGVcIik7XG5jb25zdCB0b2dnbGVNZW51ID0gZnVuY3Rpb24oKSB7XG4gIG1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnbWFpbi1uYXYtLW9wZW5lZCcpO1xuICBtZW51LmNsYXNzTGlzdC50b2dnbGUoJ21haW4tbmF2LS1jbG9zZWQnKTtcbn1cblxubWVudS5jbGFzc0xpc3QucmVtb3ZlKFwibWFpbi1uYXYtLW5vanNcIik7XG5cbmJ0bk1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIHRvZ2dsZU1lbnUoKTtcbn0pO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gIGNvbnN0IGl0c19tZW51ID0gdGFyZ2V0ID09IG1lbnUgfHwgbWVudS5jb250YWlucyh0YXJnZXQpO1xuICBjb25zdCBpdHNfYnRuTWVudSA9IHRhcmdldCA9PSBidG5NZW51O1xuICBjb25zdCBtZW51X2lzX2FjdGl2ZSA9IG1lbnUuY2xhc3NMaXN0LmNvbnRhaW5zKCdtYWluLW5hdi0tb3BlbmVkJyk7XG5cbiAgaWYgKCFpdHNfbWVudSAmJiAhaXRzX2J0bk1lbnUgJiYgbWVudV9pc19hY3RpdmUpIHtcbiAgICAgIHRvZ2dsZU1lbnUoKTtcbiAgfVxufSk7XG5cbi8vIFN0aWNrIE1lbnUgLy9cbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gbmF2Rml4ZWQoZSkge1xuICAgIGlmKHdpbmRvdy5zY3JvbGxZID49IDExNSkge1xuICAgICAgbWVudS5jbGFzc0xpc3QuYWRkKCdtYWluLW5hdi0taXMtZml4ZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbWVudS5jbGFzc0xpc3QucmVtb3ZlKCdtYWluLW5hdi0taXMtZml4ZWQnKTtcbiAgICB9XG4gIH1cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIG5hdkZpeGVkKTtcbn1cblxuLy8gc2VhcmNoIC8vXG5cbmNvbnN0IHNlYXJjaCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2VhcmNoXCIpO1xuY29uc3QgYnRuU2VhcmNoID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZWFyY2hfX3RvZ2dsZVwiKTtcbmNvbnN0IHRvZ2dsZVNlYXJjaCA9IGZ1bmN0aW9uKCkge1xuICBzZWFyY2guY2xhc3NMaXN0LnRvZ2dsZSgnc2VhcmNoLS1vcGVuZWQnKTtcbiAgc2VhcmNoLmNsYXNzTGlzdC50b2dnbGUoJ3NlYXJjaC0tY2xvc2VkJyk7XG59XG5cbmJ0blNlYXJjaC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgdG9nZ2xlU2VhcmNoKCk7XG59KTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICBjb25zdCBpdHNfc2VhcmNoID0gdGFyZ2V0ID09IHNlYXJjaCB8fCBzZWFyY2guY29udGFpbnModGFyZ2V0KTtcbiAgY29uc3QgaXRzX2J0blNlYXJjaCA9IHRhcmdldCA9PSBidG5TZWFyY2g7XG4gIGNvbnN0IHNlYXJjaF9pc19hY3RpdmUgPSBzZWFyY2guY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWFyY2gtLW9wZW5lZCcpO1xuXG4gIGlmICghaXRzX3NlYXJjaCAmJiAhaXRzX2J0blNlYXJjaCAmJiBzZWFyY2hfaXNfYWN0aXZlKSB7XG4gICAgdG9nZ2xlU2VhcmNoKCk7XG4gIH1cbn0pO1xuXG4vLyBhZGQvcmVtb3ZlIGNhdGVnb3JpZXMgb24gd2luZG93IGNoYW5nZVxuXG5sZXQgbmF2TWFpbkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1haW4tbmF2IC5jYXRlZ29yeS1saXN0XCIpO1xubGV0IG5hdk1haW5Vc2VyTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWFpbi1uYXYgLnVzZXItbGlzdFwiKTtcbmxldCBjYXRNYWluTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2F0ZWdvcmllcyAuY2F0ZWdvcnktbGlzdFwiKTtcblxuaWYgKHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1heC13aWR0aDogNzY3cHgpXCIpLm1hdGNoZXMpIHtcbiAgaWYgKGNhdE1haW5MaXN0KSB7Y2F0TWFpbkxpc3QucmVtb3ZlKCk7fVxufSBlbHNlIGlmICh3aW5kb3cubWF0Y2hNZWRpYShcIihtaW4td2lkdGg6IDc2OHB4KSBhbmQgKG1heC13aWR0aDogMTE5OXB4KVwiKS5tYXRjaGVzKSB7XG4gIGlmIChuYXZNYWluTGlzdCkge25hdk1haW5MaXN0LnJlbW92ZSgpO31cbiAgaWYgKG5hdk1haW5Vc2VyTGlzdCkge25hdk1haW5Vc2VyTGlzdC5yZW1vdmUoKTt9XG4gIGlmIChjYXRNYWluTGlzdCkge2NhdE1haW5MaXN0LnJlbW92ZSgpO31cbn0gZWxzZSBpZiAod2luZG93Lm1hdGNoTWVkaWEoXCIobWluLXdpZHRoOiAxMjAwcHgpXCIpLm1hdGNoZXMpIHtcbiAgaWYgKG5hdk1haW5MaXN0KSB7bmF2TWFpbkxpc3QucmVtb3ZlKCk7fVxuICBpZiAobmF2TWFpblVzZXJMaXN0KSB7bmF2TWFpblVzZXJMaXN0LnJlbW92ZSgpO31cbn1cblxuLy8gdGFicyAvL1xuXG5sZXQgJHRhYnMgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG5cbiAgbGV0XG4gICAgX2VsZW1UYWJzID0gKHR5cGVvZiB0YXJnZXQgPT09ICdzdHJpbmcnID8gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0YXJnZXQpIDogdGFyZ2V0KSxcbiAgICBfZXZlbnRUYWJzU2hvdyxcbiAgICBfc2hvd1RhYiA9IGZ1bmN0aW9uICh0YWJzTGlua1RhcmdldCkge1xuICAgICAgbGV0IHRhYnNQYW5lVGFyZ2V0LCB0YWJzTGlua0FjdGl2ZSwgdGFic1BhbmVTaG93O1xuICAgICAgdGFic1BhbmVUYXJnZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRhYnNMaW5rVGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpKTtcbiAgICAgIHRhYnNMaW5rQWN0aXZlID0gdGFic0xpbmtUYXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaW5nbGUtcHJvZHVjdC10YWJfX25hdi1pdGVtLS1hY3RpdmUnKTtcbiAgICAgIHRhYnNQYW5lU2hvdyA9IHRhYnNQYW5lVGFyZ2V0LnBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNpbmdsZS1wcm9kdWN0LXRhYl9fcGFuZS0tYWN0aXZlJyk7XG4gICAgICAvLyDQtdGB0LvQuCDRgdC70LXQtNGD0Y7RidCw0Y8g0LLQutC70LDQtNC60LAg0YDQsNCy0L3QsCDQsNC60YLQuNCy0L3QvtC5LCDRgtC+INC30LDQstC10YDRiNCw0LXQvCDRgNCw0LHQvtGC0YNcbiAgICAgIGlmICh0YWJzTGlua1RhcmdldCA9PT0gdGFic0xpbmtBY3RpdmUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8g0YPQtNCw0LvRj9C10Lwg0LrQu9Cw0YHRgdGLINGDINGC0LXQutGD0YnQuNGFINCw0LrRgtC40LLQvdGL0YUg0Y3Qu9C10LzQtdC90YLQvtCyXG4gICAgICBpZiAodGFic0xpbmtBY3RpdmUgIT09IG51bGwpIHtcbiAgICAgICAgdGFic0xpbmtBY3RpdmUuY2xhc3NMaXN0LnJlbW92ZSgnc2luZ2xlLXByb2R1Y3QtdGFiX19uYXYtaXRlbS0tYWN0aXZlJyk7XG4gICAgICB9XG4gICAgICBpZiAodGFic1BhbmVTaG93ICE9PSBudWxsKSB7XG4gICAgICAgIHRhYnNQYW5lU2hvdy5jbGFzc0xpc3QucmVtb3ZlKCdzaW5nbGUtcHJvZHVjdC10YWJfX3BhbmUtLWFjdGl2ZScpO1xuICAgICAgfVxuICAgICAgLy8g0LTQvtCx0LDQstC70Y/QtdC8INC60LvQsNGB0YHRiyDQuiDRjdC70LXQvNC10L3RgtCw0LwgKNCyINC30LDQstC40LzQvtGB0YLQuCDQvtGCINCy0YvQsdGA0LDQvdC90L7QuSDQstC60LvQsNC00LrQuClcbiAgICAgIHRhYnNMaW5rVGFyZ2V0LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2luZ2xlLXByb2R1Y3QtdGFiX19uYXYtaXRlbS0tYWN0aXZlJyk7XG4gICAgICB0YWJzUGFuZVRhcmdldC5jbGFzc0xpc3QuYWRkKCdzaW5nbGUtcHJvZHVjdC10YWJfX3BhbmUtLWFjdGl2ZScpO1xuICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChfZXZlbnRUYWJzU2hvdyk7XG4gICAgfSxcbiAgICBfc3dpdGNoVGFiVG8gPSBmdW5jdGlvbiAodGFic0xpbmtJbmRleCkge1xuICAgICAgbGV0IHRhYnNMaW5rcyA9IF9lbGVtVGFicy5xdWVyeVNlbGVjdG9yQWxsKCcuc2luZ2xlLXByb2R1Y3QtdGFiX19uYXYtaXRlbScpO1xuICAgICAgaWYgKHRhYnNMaW5rcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmICh0YWJzTGlua0luZGV4ID4gdGFic0xpbmtzLmxlbmd0aCkge1xuICAgICAgICAgIHRhYnNMaW5rSW5kZXggPSB0YWJzTGlua3MubGVuZ3RoO1xuICAgICAgICB9IGVsc2UgaWYgKHRhYnNMaW5rSW5kZXggPCAxKSB7XG4gICAgICAgICAgdGFic0xpbmtJbmRleCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgX3Nob3dUYWIodGFic0xpbmtzW3RhYnNMaW5rSW5kZXggLSAxXSk7XG4gICAgICB9XG4gICAgfTtcbiAgX2V2ZW50VGFic1Nob3cgPSBuZXcgQ3VzdG9tRXZlbnQoJ3RhYi5zaG93JywgeyBkZXRhaWw6IF9lbGVtVGFicyB9KTtcblxuICBfZWxlbVRhYnMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgIGxldCB0YWJzTGlua1RhcmdldCA9IGUudGFyZ2V0O1xuICAgIC8vINC30LDQstC10YDRiNCw0LXQvCDQstGL0L/QvtC70L3QtdC90LjQtSDRhNGD0L3QutGG0LjQuCwg0LXRgdC70Lgg0LrQu9C40LrQvdGD0LvQuCDQvdC1INC/0L4g0YHRgdGL0LvQutC1XG4gICAgaWYgKCF0YWJzTGlua1RhcmdldC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc2luZ2xlLXByb2R1Y3QtdGFiX19uYXYtaXRlbScpIHx8IHRhYnNMaW5rVGFyZ2V0LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaW5nbGUtcHJvZHVjdC10YWJfX25hdi1pdGVtLS1ub3RhYicpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vINC+0YLQvNC10L3Rj9C10Lwg0YHRgtCw0L3QtNCw0YDRgtC90L7QtSDQtNC10LnRgdGC0LLQuNC1XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIF9zaG93VGFiKHRhYnNMaW5rVGFyZ2V0KTtcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBzaG93VGFiOiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICBfc2hvd1RhYih0YXJnZXQpO1xuICAgIH0sXG4gICAgc3dpdGNoVGFiVG86IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgX3N3aXRjaFRhYlRvKGluZGV4KTtcbiAgICB9XG4gIH1cblxufTtcbmxldCBsaXN0VGFicyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zaW5nbGUtcHJvZHVjdC10YWJzJyk7XG5mb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gbGlzdFRhYnMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgJHRhYnMobGlzdFRhYnNbaV0pO1xufVxuXG4vLyB0YWItYW5jaG9yIHNjcm9sbCB0byAvL1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhW2hyZWZePVwiI1wiXS5hbmNob3ItbGluaycpLmZvckVhY2gobGluayA9PiB7XG5cbiAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgbGV0IGhyZWYgPSB0aGlzLmdldEF0dHJpYnV0ZSgnaHJlZicpLnN1YnN0cmluZygxKTtcblxuICAgICAgY29uc3Qgc2Nyb2xsVGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaHJlZik7XG5cbiAgICAgIGNvbnN0IHRvcE9mZnNldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaW5nbGUtcHJvZHVjdC10YWJfX25hdi1saXN0Jykub2Zmc2V0SGVpZ2h0O1xuICAgICAgLy8gY29uc3QgdG9wT2Zmc2V0ID0gMDsgLy8g0LXRgdC70Lgg0L3QtSDQvdGD0LbQtdC9INC+0YLRgdGC0YPQvyDRgdCy0LXRgNGF0YNcbiAgICAgIGNvbnN0IGVsZW1lbnRQb3NpdGlvbiA9IHNjcm9sbFRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG4gICAgICBjb25zdCBvZmZzZXRQb3NpdGlvbiA9IGVsZW1lbnRQb3NpdGlvbiAtIHRvcE9mZnNldCAtIDYwO1xuXG4gICAgICB3aW5kb3cuc2Nyb2xsQnkoe1xuICAgICAgICAgIHRvcDogb2Zmc2V0UG9zaXRpb24sXG4gICAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnXG4gICAgICB9KTtcbiAgfSk7XG59KTtcblxuLyogcG9wdXAtY2l0eSAqL1xuXG5sZXQgY2l0eUxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNpdHktY2hvb3NpbmdfX2NpdHlcIik7XG5cbmlmIChjaXR5TGluay5sZW5ndGggIT09IDApIHtcbiAgbGV0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtb2RhbF9fZ2VvXCIpO1xuICBsZXQgcG9wdXBDbG9zZSA9IHBvcHVwLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJtb2RhbF9fYnV0dG9uLS1jbG9zZVwiKTtcblxuICBwb3B1cEFjdGlvbihjaXR5TGluaywgcG9wdXAsIHBvcHVwQ2xvc2UpO1xufVxuXG4vKiBwb3B1cC1hZGRDYXJ0ICovXG5cbmxldCBncmlkQWRkQ2FydExpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmFydGljbGUtcHJvZHVjdC1nX19jYXJ0XCIpO1xuXG5pZiAoZ3JpZEFkZENhcnRMaW5rLmxlbmd0aCAhPT0gMCkge1xuICBsZXQgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1vZGFsX19hZGQtY2FydFwiKTtcbiAgbGV0IHBvcHVwQ2xvc2UgPSBwb3B1cC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwibW9kYWxfX2J1dHRvbi0tY2xvc2VcIik7XG5cbiAgcG9wdXBBY3Rpb24oZ3JpZEFkZENhcnRMaW5rLCBwb3B1cCwgcG9wdXBDbG9zZSk7XG59XG5cbmxldCBsaXN0QWRkQ2FydExpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmFydGljbGUtcHJvZHVjdC1sX19jYXJ0XCIpO1xuXG5pZiAobGlzdEFkZENhcnRMaW5rLmxlbmd0aCAhPT0gMCkge1xuICBsZXQgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1vZGFsX19hZGQtY2FydFwiKTtcbiAgbGV0IHBvcHVwQ2xvc2UgPSBwb3B1cC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwibW9kYWxfX2J1dHRvbi0tY2xvc2VcIik7XG5cbiAgcG9wdXBBY3Rpb24obGlzdEFkZENhcnRMaW5rLCBwb3B1cCwgcG9wdXBDbG9zZSk7XG59XG5cbmxldCBwcm9kdWN0QWRkQ2FydExpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNpbmdsZS1wcm9kdWN0X19idXR0b24tYnV5XCIpO1xuXG5pZiAocHJvZHVjdEFkZENhcnRMaW5rLmxlbmd0aCAhPT0gMCkge1xuICBsZXQgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1vZGFsX19hZGQtY2FydFwiKTtcbiAgbGV0IHBvcHVwQ2xvc2UgPSBwb3B1cC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwibW9kYWxfX2J1dHRvbi0tY2xvc2VcIik7XG5cbiAgcG9wdXBBY3Rpb24ocHJvZHVjdEFkZENhcnRMaW5rLCBwb3B1cCwgcG9wdXBDbG9zZSk7XG59XG5cbi8qIHBvcHVwLWNhbGxiYWNrICovXG5cbmxldCBwcm9kdWN0Q2FsbGJhY2tMaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zaW5nbGUtcHJvZHVjdF9fY2FsbGJhY2tcIik7XG5cbmlmIChwcm9kdWN0Q2FsbGJhY2tMaW5rLmxlbmd0aCAhPT0gMCkge1xuICBsZXQgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1vZGFsX19jYWxsYmFja1wiKTtcbiAgbGV0IHBvcHVwQ2xvc2UgPSBwb3B1cC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwibW9kYWxfX2J1dHRvbi0tY2xvc2VcIik7XG5cbiAgcG9wdXBBY3Rpb24ocHJvZHVjdENhbGxiYWNrTGluaywgcG9wdXAsIHBvcHVwQ2xvc2UpO1xufVxuXG4vKiBwb3B1cC1idXlvYyAqL1xuXG5sZXQgc1Byb2R1Y3RCdXlvY0xpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNpbmdsZS1wcm9kdWN0X19idXR0b24tYnV5b2NcIik7XG5cbmlmIChzUHJvZHVjdEJ1eW9jTGluay5sZW5ndGggIT09IDApIHtcbiAgbGV0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtb2RhbF9fYnV5b2NcIik7XG4gIGxldCBwb3B1cENsb3NlID0gcG9wdXAuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcIm1vZGFsX19idXR0b24tLWNsb3NlXCIpO1xuXG4gIHBvcHVwQWN0aW9uKHNQcm9kdWN0QnV5b2NMaW5rLCBwb3B1cCwgcG9wdXBDbG9zZSk7XG59XG5cbmxldCBncmlkQnV5b2NMaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5hcnRpY2xlLXByb2R1Y3QtZ19fYnV5b25lY2xpY2tcIik7XG5cbmlmIChncmlkQnV5b2NMaW5rLmxlbmd0aCAhPT0gMCkge1xuICBsZXQgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1vZGFsX19idXlvY1wiKTtcbiAgbGV0IHBvcHVwQ2xvc2UgPSBwb3B1cC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwibW9kYWxfX2J1dHRvbi0tY2xvc2VcIik7XG5cbiAgcG9wdXBBY3Rpb24oZ3JpZEJ1eW9jTGluaywgcG9wdXAsIHBvcHVwQ2xvc2UpO1xufVxuXG5sZXQgbGlzdEJ1eW9jTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYXJ0aWNsZS1wcm9kdWN0LWxfX2J1eW9uZWNsaWNrXCIpO1xuXG5pZiAobGlzdEJ1eW9jTGluay5sZW5ndGggIT09IDApIHtcbiAgbGV0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtb2RhbF9fYnV5b2NcIik7XG4gIGxldCBwb3B1cENsb3NlID0gcG9wdXAuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcIm1vZGFsX19idXR0b24tLWNsb3NlXCIpO1xuXG4gIHBvcHVwQWN0aW9uKGxpc3RCdXlvY0xpbmssIHBvcHVwLCBwb3B1cENsb3NlKTtcbn1cblxuZnVuY3Rpb24gcG9wdXBBY3Rpb24ocG9wdXBMaW5rLCBwb3B1cCwgcG9wdXBDbG9zZSkge1xuXG4gIGxldCB0b2dnbGVDaXR5ID0gZnVuY3Rpb24oKSB7XG4gICAgcG9wdXAuY2xhc3NMaXN0LnRvZ2dsZSgnbW9kYWxfX3Nob3cnKTtcbiAgfVxuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcG9wdXBMaW5rLmxlbmd0aDsgaSsrKSB7XG4gICAgcG9wdXBMaW5rW2ldLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0b2dnbGVDaXR5KCk7XG4gICAgfSk7XG4gIH1cblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHBvcHVwQ2xvc2UubGVuZ3RoOyBpKyspIHtcbiAgICBwb3B1cENsb3NlW2ldLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICBpZiAocG9wdXAuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX3Nob3dcIikpIHtcbiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9fc2hvd1wiKTtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX19lcnJvclwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgaWYgKGV2dC5rZXlDb2RlID09PSAyNykge1xuICAgICAgaWYgKHBvcHVwLmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX19zaG93XCIpKSB7XG4gICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfX3Nob3dcIik7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9fZXJyb3JcIik7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2dCkge1xuICAgIGNvbnN0IHRhcmdldCA9IGV2dC50YXJnZXQ7XG4gICAgY29uc3QgaXRzX3BvcHVwID0gdGFyZ2V0ID09IHBvcHVwIHx8IHBvcHVwLmNvbnRhaW5zKHRhcmdldCk7XG4gICAgY29uc3QgaXRzX3BvcHVwTGluayA9IHRhcmdldCA9PSBwb3B1cExpbms7XG4gICAgY29uc3QgcG9wdXBfaXNfYWN0aXZlID0gcG9wdXAuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fc2hvdycpO1xuXG4gICAgaWYgKCFpdHNfcG9wdXAgJiYgIWl0c19wb3B1cExpbmsgJiYgcG9wdXBfaXNfYWN0aXZlKSB7XG4gICAgICB0b2dnbGVDaXR5KCk7XG4gICAgfVxuICB9KTtcbn1cblxuLyogZ3JpZC1saXN0ICovXG5sZXQgcHJvZHVjdHNHcmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9kdWN0cy1ncmlkXCIpO1xubGV0IHByb2R1Y3RzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZHVjdHMtbGlzdFwiKTtcblxuaWYgKHByb2R1Y3RzR3JpZCAmJiBwcm9kdWN0c0xpc3QpIHtcbiAgbGV0IGdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNvcnRpbmctZmlsdGVyX19nLWJ0blwiKTtcbiAgbGV0IGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNvcnRpbmctZmlsdGVyX19sLWJ0blwiKTtcblxuICB0b2dnbGVHbChncmlkLCBsaXN0KTtcblxuICBmdW5jdGlvbiB0b2dnbGVHbChncmlkLCBsaXN0KSB7XG4gICAgZ3JpZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2dCkge1xuICAgICAgcHJvZHVjdHNHcmlkLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgIGxpc3QuY2xhc3NMaXN0LnJlbW92ZShcInNvcnRpbmctZmlsdGVyX19nbC1idG4tLWFjdGl2ZVwiKTtcbiAgICAgIGdyaWQuY2xhc3NMaXN0LmFkZChcInNvcnRpbmctZmlsdGVyX19nbC1idG4tLWFjdGl2ZVwiKTtcbiAgICAgIHByb2R1Y3RzTGlzdC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfSk7XG5cbiAgICBsaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZ0KSB7XG4gICAgICBwcm9kdWN0c0dyaWQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgZ3JpZC5jbGFzc0xpc3QucmVtb3ZlKFwic29ydGluZy1maWx0ZXJfX2dsLWJ0bi0tYWN0aXZlXCIpO1xuICAgICAgbGlzdC5jbGFzc0xpc3QuYWRkKFwic29ydGluZy1maWx0ZXJfX2dsLWJ0bi0tYWN0aXZlXCIpO1xuICAgICAgcHJvZHVjdHNMaXN0LnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICB9KTtcbiAgfVxufVxuIl19
